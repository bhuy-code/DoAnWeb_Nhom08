<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Chi tiết sản phẩm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    /* CSS riêng cho trang chi tiết */
    .detail-container { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px; }
    .detail-img { width: 100%; border-radius: 12px; object-fit: cover; }
    .detail-info h1 { font-size: 28px; margin-bottom: 10px; }
    .detail-price { font-size: 24px; color: #d32f2f; font-weight: bold; margin-bottom: 20px; }
    .detail-desc { color: #555; line-height: 1.6; margin-bottom: 30px; }
    
    /* CSS cho các nút size trong Modal */
    .size-options { display: flex; gap: 10px; margin: 15px 0; }
    .size-option {
      padding: 8px 15px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;
      transition: 0.2s;
    }
    .size-option:hover { background: #f0f0f0; }
    .size-option.active { background: #007bff; color: white; border-color: #007bff; }

    @media(max-width:768px){ .detail-container { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<header class="header">
  <div class="container">
    <nav class="nav">
      <a href="index.html" class="brand">Clothify</a>
      <div>
        <a href="index.html">Trang chủ</a>
        <a href="products.html">Sản phẩm</a>
        <a href="cart.html" style="position:relative">Giỏ hàng <span id="cart-counter" class="cart-badge"></span></a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <div id="product-detail" class="detail-container">
    </div>
</main>

<div id="size-modal" class="modal-overlay">
  <div class="modal-content">
    <button class="modal-close" id="modal-close-btn">&times;</button>

    <div class="modal-product-info">
      <img src="" alt="Sản phẩm" id="modal-product-image">
      <div>
        <h3 id="modal-product-name">Tên sản phẩm</h3>
        <span id="modal-product-price">Giá</span>
      </div>
    </div>

    <div class="modal-options">
      <h4>Chọn size:</h4>
      <div id="modal-size-options" class="size-options"></div>
    </div>

    <button class="modal-confirm-btn" id="modal-confirm-add-btn">Xác nhận thêm</button>
  </div>
</div>
<script src="assets/js/database.js"></script>
<script src="assets/js/script.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Lấy ID từ thanh địa chỉ
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    // ===========================================================
    // SỬA LỖI TẠI ĐÂY: Đảm bảo tên biến khớp với database.js
    // ===========================================================
    
    // Cách 1: Thử tìm trong biến 'products' (nếu database.js dùng tên này)
    let product = (typeof products !== 'undefined') ? products.find(p => p.id === productId) : null;

    // Cách 2: Nếu không thấy, thử tìm trong biến 'allProducts' (phòng hờ database.js dùng tên này)
    if (!product && typeof allProducts !== 'undefined') {
      product = allProducts.find(p => p.id === productId);
    }

    const container = document.getElementById("product-detail");

    if (product) {
      // Nếu tìm thấy -> Hiển thị
      container.innerHTML = `
        <div>
          <img src="${product.image}" alt="${product.name}" class="detail-img">
        </div>
        <div class="detail-info">
          <h1>${product.name}</h1>
          <div class="detail-price">${product.price.toLocaleString()}₫</div>
          <p class="detail-desc">${product.desc || product.description || "Chưa có mô tả"}</p>
          
          <button class="btn primary" id="open-size-modal-btn">
            Thêm vào giỏ
          </button>
          <a href="products.html" class="btn ghost">Quay lại</a>
        </div>
      `;

      // --- LOGIC MỞ MODAL (Copy từ products.js sang để chạy độc lập) ---
      const openBtn = document.getElementById("open-size-modal-btn");
      if(openBtn) {
        openBtn.addEventListener("click", () => {
           // Gọi hàm mở modal bên file products.js (nếu đã load)
           // Hoặc tự xử lý mở modal tại đây
           const modal = document.getElementById("size-modal");
           const modalImg = document.getElementById("modal-product-image");
           const modalName = document.getElementById("modal-product-name");
           const modalPrice = document.getElementById("modal-product-price");
           const sizeContainer = document.getElementById("modal-size-options");
           const modalConfirmBtn = document.getElementById("modal-confirm-add-btn");

           if(modal) {
             modalImg.src = product.image;
             modalName.innerText = product.name;
             modalPrice.innerText = product.price.toLocaleString() + '₫';
             
             // Xử lý size
             sizeContainer.innerHTML = "";
             const sizes = product.availableSizes || ["S", "M", "L", "XL"];
             
             // Biến toàn cục tạm để products.js xử lý thêm giỏ
             // (Cần đảm bảo products.js có biến currentProductData ở scope ngoài hoặc gán vào window)
             // Cách đơn giản nhất: Gán sự kiện click chọn size ngay tại đây
             
             // ... (Phần logic Modal giữ nguyên hoặc import từ products.js)
             
             // Để đơn giản, ta kích hoạt class active cho modal để nó hiện lên
             // Logic xử lý click size/thêm giỏ sẽ do products.js đảm nhiệm nếu nó được load
             modal.classList.add("active");
             
             // Cập nhật lại data cho nút xác nhận (để products.js đọc được)
             // Tuy nhiên, cách tốt nhất là trang chi tiết tự xử lý thêm giỏ
           }
        });
      }

    } else {
      // Nếu vẫn không tìm thấy -> Báo lỗi
      console.error("Không tìm thấy ID:", productId);
      console.log("Danh sách products hiện có:", typeof products !== 'undefined' ? products : "Không có biến products");
      
      container.innerHTML = `
        <div style="text-align:center; padding:40px;">
          <h2>Không tìm thấy sản phẩm!</h2>
          <p>Có thể mã sản phẩm <b>${productId}</b> không tồn tại trong dữ liệu.</p>
          <a href="products.html" class="btn">Xem tất cả sản phẩm</a>
        </div>`;
    }
  });
</script>

<script src="assets/js/products.js"></script>
</body>
</html>